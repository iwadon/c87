# LINE乗っ取り詐欺

今年、一般人が最も意識したセキュリティ事案といえば**LINE乗っ取り詐欺**だろう。
どうやら世の中ではLINEが完全に社会インフラとなっており、
そこに構築されたソーシャルグラフを狙った詐欺に、
かつて無いほど沢山の人がコロッと騙された。

また、日本語で詐欺が行われ、ほぼ日本人が詐欺のターゲットであったにも関わらず、
登場するインフラはすべて海外のもので、
日本の司法のちからが全く及ばず、被害者は完全に泣き寝入りとなった。
法の異なる海外インフラを使うことのリスクも浮き彫りになった。
グローバルなインフラを使った大規模な国際詐欺事件といえるかもしれない。

## 概要

LINE乗っ取り詐欺とは、名前の通りLINEのアカウントを乗っ取り、
友人のフリをして金品を騙し取る詐欺だ。
微妙に変な日本語でiTunesカードを買ってくださいというアレだ。
6月中旬から流行り始め、いくつかの対策によりだんだん下火になったものの、
現在でもほそぼそと形を変え新たな詐欺が続いているらしい。

Twitterの自分のクラスタを見ると、ほとんどの人は疑り深く、
その変な文章をネタとして消化していたようだ。
しかし一部には、友人からの投稿ということを完全に信用してしまい、
詐欺に引っかかってしまった人がいたようだ。
自分の周囲にも一人だけ、最も詐欺に引っかかりやすそうだと思っていた人が気持ちよく引っかかっていた。
全体ではどれほどの成功率だったのだろうか。

## 犯人像

犯人に画像ファイルを踏ませ、IPアドレスを取得した人によると、初期の接続元は[中国本土](http://blog.nzakr.com/line-webmoney/)だったようだ。
2ヶ月過ぎた頃には[Proxyを使っている](http://www.lancork.net/2014/08/line-login-attack-ip-address-and-country/)様子が見られるので、
今IPアドレスを取得しても大して意味がないだろう。
**天安門事件**でログアウトしたという報告もあるので、中国本土の可能性は非常に高い。

## 警察の対応

基本的に[警察は動けない](http://youpouch.com/2014/07/17/211746/)らしい。
正確なところはわからないが、やはり海外企業だと警察は操作しにくいようだ。
よく誤解されるが、[不正アクセス禁止法](http://law.e-gov.go.jp/htmldata/H11/H11HO128.html)の被害者は、*ユーザではなくアクセス管理者*、つまりサービス運営者である。
よって、乗っ取られた本人が[被害届を出すことはできない](http://www.pref.oita.jp/site/keisatu/new/kouhou/soudan/hightech-fuseiakusesu.html)ようだ。
**意図的に**サービス運営者が被害届を出さなかった場合、最初から事件など無かったことになるのかもしれない。

ただ、不正アクセス禁止法は[親告罪](http://ja.wikipedia.org/wiki/%E8%A6%AA%E5%91%8A%E7%BD%AA)ではないので、
警察は事件を知った時から自主的に捜査を開始できるのだろうか?
法律は詳しくないので解釈があっているかわからない。

とは言え、この場合は[詐欺で被害届](http://matome.naver.jp/odai/2140651154305866601)を出しているようで、そちらで警察は動いたようだが、まぁセキュリティには関係ない。

## LINEの対応

LINEの対応はグダグダだった。
当初は[パスワードを変更するようアナウンス](http://official-blog.line.me/ja/archives/1004331596.html)するだけで、システム的な対処は全くされなかった。
その後1ヶ月ほどして、やっと[PINコードなどが実装](http://official-blog.line.me/ja/archives/1006009191.html)され、さらに2ヶ月後に[PINコードが必須](http://official-blog.line.me/ja/archives/1009539887.html)になったようだ。

しかし、このPINコード必須化の時にも不手際があり、
PINコード未登録のユーザの初期値を[**電話番号の下4桁**という**公開情報**](http://did2memo.net/2014/07/16/naver-line-default-pin-code/)にしてしまったため、全くセキュリティの意味を成さなかった。
ID/passwordが流出済みかつ既にLINEを使っていないアカウントには、**その友人なら**簡単にログイン可能だ。
確かにアクティブユーザの多いLINEではそれほど問題にはならなかったかもしれないが。
同じことを~~もう誰もログインしない~~mixiがやっていたら完全に無駄だっただろう。

PINコードの実装により、乗っ取りは激減したようだが、
完全になくなったわけではなく、その後もちらほら乗っ取られた報告がある。
初期値の問題もあるが、[完全に新規アカウントでパスワードはランダムにしてPINコードも設定していたのに乗っ取られた](http://www.landerblue.co.jp/blog/?p=14188)という報告もあるようだ。

ここで言う「乗っ取られた報告」というのは、**乗っ取られた本人**による報告である。
「友人が乗っ取られてメッセージを送ってきた」というのではない。
PIN実装直後に「友人が乗っ取られてメッセージを送ってきた」のは、**友人本人が乗っ取られたふりをして詐欺をしようとした**可能性が高い。
そのタイミングで乗っ取られていた友人がいたなら*十分に警戒*すべきだ。

## 乗っ取り方法

LINEはOAuthのような認可の仕組みは公開されていないので、
どうやらアカウントは本当に乗っ取られていたようだ。
つまり、本物のユーザIDとパスワードを使ってログインされたということだ。

IDとパスワードの流出元は、先の大規模リスト型攻撃が最有力候補とされている。
リストの巨大さ、リテラシの低さからもその可能性は非常に高いだろう。

しかし、信憑性はわからないが、パスワードを変えた直後から再び乗っ取られたという話も聞く。
パスワードを変えた直後から乗っ取られたということは、どこかからパスワードが漏れているという可能性もある。

変更直後に乗っ取られたという報告も、PINコードを設定していても乗っ取られたという報告も、それほど多くない。
それほど多くはないということは、直接サーバから漏れた可能性は低いと推測できる。
端末に**ウイルス**や**キーロガー**的なものを仕掛けられていたか、
フィッシングに引っかかった等、本人に問題があると考えたほうが妥当だと思う。

## 韓国国情院のLINE傍受問題

直接的な関係は無いと思われるが、**韓国国情院**が[LINEの通信の傍受](http://facta.co.jp/article/201407039.html)を認めたという大事件が起こった。
韓国国情院はアメリカのCIAとNSAを足したような諜報機関で、
過去の軍事独裁政権時代は日本の特高警察のような荒っぽいことをしていたようだ。
ちなみに、記事中では韓国に通信の秘密がないと書かれているが、[各国のセキュリティ事情を比較した最新の研究](http://www.canon-igs.org/research_papers/pdf/201405_sog_report.pdf)でも触れられているように、むしろ他国より充実しているように見える。

LINEは[実行不可能と断言](http://moriaki.blog.jp/archives/1988243.html)している。
確かに正しい技術を選択し正しい実装をしていれば、技術的にセキュリティを突破することは不可能と断言できるだろう。
ただし技術的に不可能なだけだ。
技術的ではない攻撃手法はいくらでもある。
LINEのような、広く使われプライベートな情報が飛び交う社会インフラは、
攻撃者ならどんな手段を使ってでも攻撃したいだろう。

具体的に言うと、**サーバ管理者は本当に信頼できるか**ということである。
サーバ管理者は基本的に何でもできる。
いくら通信にSSLを使っていても、管理者なら復号後の通信内容を見ることができる。
証明書にもアクセスできるので、漏らすことも自ら偽サーバを建てることもできる。
サーバ管理者は容易かつ確実な方法で、最強の中間攻撃者になりうるのである。
攻撃がバレるとしても、不正を行った事後のことなので手遅れだ。

果たしてLINEはサーバ管理者をコントロールできているのだろうか。
LINE社は日本の法人だが、親会社は韓国のネイバー社だ。
サービス自体はLINE社が開発しているが、サーバはすべてネイバー社が管理している、
というような状況だとしたら、完全にコントロールできているとは言えず、
傍受は不可能と断言することはできないと思う。

## 考察

この問題の詳細が明らかになることは未来永劫ないと思うが、
考察を進めるにつれ、サーバ管理者という強権の危険性にもっと注意を払うべきだと確信した。

サーバ管理者が人間である以上、それは脆弱性だ。
どれだけ真面目な人でも不正を働く可能性はある。
こめかみに拳銃を突きつけられたら誰だって命を優先する。
すべての人間を悪とみなすように、サーバ管理者も悪とみなすべきだ。

複数のサーバ管理者による相互監視や作業ログの可視化なども重要であろうが、
アプリケーションを作る側もサーバ管理者をきちんと警戒するべきだ。
パスワードを保存するときに**ハッシュ化**するというのは今や常識だが、
これはデータの流出に耐性があるという理由もあるが、
なにより**管理者が見てはいけないデータを見えないようにする**という側面が強い。

しかし保存時にハッシュ化するだけでは、データベース上ではハッシュ化されるが**通信上では生パスワード**が流れる。
これではアプリケーション側に1行ログ出力を挟むだけで**メールアドレスと生パスワード**が漏洩する。
多くの人はパスワードを使い回しているので、これだけで攻撃用リストの完成だ。
自社サービスのみならず他社サービスを攻撃することもできてしまう。

これを避けるために、パスワード送信前に**javascriptで一度ハッシュ化**し、
更に今までどおりデータベース保存時に**もう一度ハッシュ化**するべきだ。
こうするとたとえサーバ管理者でもユーザの生パスワードを見ることはできなくなる。
もちろん、覗き見たハッシュ済みパスワードを直接POSTすれば**自社サービスにはログインできるが、他社サービスにはログインできない**。
もちろん**SALT**はお忘れなく。
パスワードの使い回しは大変危険で大きな問題だが、使い回さないことをユーザに期待できないし強制もできない。
そういう世の中で各サービスが送信前にハッシュするのはだいぶ意義があるのではないかと思う。

## 総括

国民的と言っていいインフラサービスで起こった事件は、今までにない爆発的な広まりを見せ、大規模インフラの持つ危うさを明らかにした。
このような高度に集積されたネットワークは、自分に全く落ち度がないとしても、ソーシャル上のうかつな他人を通じて被害者となることも目の当たりにした。
使うサービスや繋がる人の選択は、よく信頼性を吟味し個人が責任を持って選択しなければならない時代だと言える。

実際、韓国では大統領の発言を受け、LINEやカカオトーク(どちらも韓国企業)は**信頼できないサービス**と判断され、海外のメッセージングサービスに**サイバー亡命**する人が跡を絶たないという。
韓国はメッセージングサービスの先駆者的存在をいくつも排出したメッセージングサービス先進国であるのに、国産サービスが国民からそっぽを向かれ始めているという残念な状態だ。
